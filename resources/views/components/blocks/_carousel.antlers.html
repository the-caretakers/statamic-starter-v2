{{ partial:components/block }}
    {{ if style == 'All Showing' }}
        <div
            x-data="{
            activeIndex: 0, // Index of the currently active (expanded) item, 0 for the first item
            itemsCount: {{ items | length }}, // Total number of items, default to 0 if items is empty/null
            expandedWidthPercentage: 40, // Width of the active item as a percentage

            // Calculates the flex-basis for an item based on whether it's active or not
            getItemFlexBasis(index) {
                // On mobile, don't apply flex-basis calculations
                if (window.innerWidth < 768) return 'auto';

                if (this.itemsCount <= 0) return '0%'; // Should not happen with data
                if (this.itemsCount === 1) return '100%'; // Single item takes full width

                if (index === this.activeIndex) {
                    return this.expandedWidthPercentage + '%';
                } else {
                    const inactiveCount = this.itemsCount - 1;
                    const remainingPercentage = 100 - this.expandedWidthPercentage;
                    return (remainingPercentage / inactiveCount) + '%';
                }
            }
        }"
            class="flex flex-col md:flex-row h-auto md:h-[600px] w-full rounded-outer overflow-hidden bg-black divide-y md:divide-y-0 md:divide-x divide-white"
{{#             @mouseleave="if (itemsCount > 0) activeIndex = 0" #}}
        >
            {{ items }}
                <div
                    @mouseenter="activeIndex = {{ index }}" {{# Update activeIndex on hover; 'index' is 0-based from Antlers #}}
                    @click="activeIndex = {{ index }}" {{# Also handle click for mobile #}}
                    class="relative md:h-full w-full overflow-hidden cursor-pointer md:cursor-default transition-all duration-700 ease-in-out group"
                    :class="{
                        'h-[300px]': activeIndex === {{ index }},
                        'h-[70px]': activeIndex !== {{ index }}
                    }"
                    :style="{ flexBasis: getItemFlexBasis({{ index }}) }"
                    role="region"
                    aria-label="{{ title }}"
                >
                    {{# Background image with brightness filter #}}
                    <div
                        class="absolute inset-0 bg-cover bg-center transition-all duration-700"
                        style="background-image: url('{{ glide :src="image" preset="xl-webp" width="1000" height="1000" fit="crop_focal" }}');"
                        :style="{ filter: activeIndex === {{ index }} ? 'brightness(1)' : 'brightness(0.7)' }"
                    ></div>

                    {{# Overlay #}}
                    <div
                        class="absolute inset-0 transition-opacity duration-700 ease-in-out pointer-events-none"
                        :class="activeIndex === {{ index }} ? 'bg-black/40' : 'bg-black/60'"
                    ></div>

                    <div
                        x-show="activeIndex === {{ index }}"
                        x-transition:enter="transition ease-out duration-500 delay-500"
                        x-transition:enter-start="opacity-0 transform translate-y-6"
                        x-transition:enter-end="opacity-100 transform translate-y-0"
                        x-transition:leave="transition ease-in duration-50"
                        x-transition:leave-start="opacity-100 transform translate-y-0"
                        x-transition:leave-end="opacity-0 transform translate-y-6"
                        class="absolute inset-0 p-6 md:p-8 lg:p-10 text-white flex flex-col justify-end items-start z-10"
                        :aria-hidden="activeIndex !== {{ index }}"
                    >
                        <h3 class="text-2xl lg:text-3xl font-bold mb-3 md:mb-4 leading-tight">{{ title }}</h3>
                        <p class="mb-4 md:mb-6 text-sm sm:text-base lg:text-lg max-w-md leading-relaxed">{{ content }}</p>
                        {{ if ! (buttons | is_empty) }}
                            <div class="flex flex-col gap-4">
                                {{ buttons }}
                                    {{ partial:components/common/button size="sm" style="Outlined" colour="white" }}
                                {{ /buttons }}
                            </div>
                        {{ /if }}
                    </div>

                    {{# Title for inactive items - horizontal on mobile, vertical on desktop #}}
                    <div
                        x-show="activeIndex !== {{ index }}"
                        x-transition:enter="transition ease-out duration-300 delay-200"
                        x-transition:enter-start="opacity-0"
                        x-transition:enter-end="opacity-100"
                        x-transition:leave="transition ease-in duration-200"
                        x-transition:leave-start="opacity-100"
                        x-transition:leave-end="opacity-0"
                        class="absolute inset-0 flex items-end md:items-start justify-start p-6 md:p-8 lg:p-10 z-10 pointer-events-none"
                    >
                        {{# Mobile: horizontal text at bottom #}}
                        <div class="block md:hidden text-white">
                            <h3 class="uppercase tracking-widest text-sm">{{ title }}</h3>
                        </div>

                        {{# Desktop: vertical text at left #}}
                        <div class="hidden md:block vertical-title-wrapper text-white text-sm">
                            {{ partial:components/text/subtitle class="vertical-text" }}
                                {{ title }}
                            {{ /partial:components/text/subtitle }}
                        </div>
                    </div>
                </div>
            {{ /items }}
        </div>
    {{ else }}
        <div
            x-data="{
                activeIndex: 0,
                itemsCount: {{ items | length }},
            }"
        >
            {{ items }}
                <div
                    x-show="activeIndex === {{ index }}"
                    class="grid grid-cols-2"
                >
                    <div class="flex flex-col justify-between">
                        <div>
                            <ul class="flex gap-2">
                                <template x-for="i in itemsCount">
                                    <li>
                                        <button
                                            class="size-6 rounded-full transition-colors"
                                            :class="{ 'bg-primary': activeIndex == i-1, 'bg-gray hover:bg-primary': activeIndex !== i-1 }"
                                            @click="activeIndex = i - 1"
                                        ></button>
                                    </li>
                                </template>
                            </ul>
                        </div>

                        <div class="flex flex-col gap-8 mt-auto pr-16">
                            <h3 class="text-lg">
                                {{ title }}
                            </h3>

                            <p class="font-bold text-3xl">
                                {{ content }}
                            </p>
                        </div>
                    </div>

                    <div x-show="activeIndex === {{ index }}">
                        {{ partial:components/common/image :url="image" }}
                    </div>
                </div>
            {{ /items }}
        </div>
    {{ /if }}
{{ /partial:components/block }}
