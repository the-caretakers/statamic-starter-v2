{{ partial:components/block }}
    {{ if images }}
        <div
            {{ if lightbox }}
                x-data="{
                    selectedImage: null,
                    selectedIndex: 0,
                    images: [
                        {{ images }}
                            '{{ glide :src="url" preset="xl" }}',
                        {{ /images }}
                    ],
                    openLightbox(index) {
                        this.selectedIndex = index;
                        this.selectedImage = this.images[index];
                    },
                    nextImage() {
                        if (this.selectedIndex < this.images.length - 1) {
                            this.selectedIndex++;
                            this.selectedImage = this.images[this.selectedIndex];
                        }
                    },
                    prevImage() {
                        if (this.selectedIndex > 0) {
                            this.selectedIndex--;
                            this.selectedImage = this.images[this.selectedIndex];
                        }
                    }
                }"
            {{ /if }}
        >
            <!-- Gallery Grid -->
            <div class="grid gap-4 {{ switch(
                (columns == '2') => 'grid-cols-1 sm:grid-cols-2',
                (columns == '3') => 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3',
                (columns == '4') => 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-4',
                (columns == '5') => 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-5',
                (columns == '6') => 'grid-cols-2 sm:grid-cols-3 lg:grid-cols-6',
                () => 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3'
            )}}">
                {{ images }}
                    <div class="relative aspect-square overflow-hidden rounded-outer">
                        {{ if lightbox }}
                            <button
                                type="button"
                                @click="openLightbox({{ index }})"
                                class="w-full h-full group"
                            >
                                <img
                                    src="{{ glide :src="url" preset="lg" fit="crop" }}"
                                    alt="{{ alt ?? 'Gallery image' }}"
                                    class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                                    loading="lazy"
                                >
                            </button>
                        {{ else }}
                            <img
                                src="{{ glide :src="url" preset="lg" fit="crop" }}"
                                alt="{{ alt ?? 'Gallery image' }}"
                                class="w-full h-full object-cover"
                                loading="lazy"
                            >
                        {{ /if }}
                    </div>
                {{ /images }}
            </div>

            {{ if lightbox }}
                <!-- Lightbox Modal -->
                <div
                    x-show="selectedImage"
                    x-cloak
                    @click="selectedImage = null"
                    @keydown.escape.window="selectedImage = null"
                    @keydown.arrow-left.window="prevImage()"
                    @keydown.arrow-right.window="nextImage()"
                    class="fixed inset-0 z-[110] bg-black/90 flex items-center justify-center p-4"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0"
                    x-transition:enter-end="opacity-100"
                    x-transition:leave="transition ease-in duration-200"
                    x-transition:leave-start="opacity-100"
                    x-transition:leave-end="opacity-0"
                >
                    <div class="relative max-w-7xl max-h-[90vh] w-full">
                        <!-- Close button -->
                        <button
                            @click.stop="selectedImage = null"
                            class="absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors"
                        >
                            {{ partial:svg/cross class="w-8 h-8" }}
                        </button>

                        <!-- Navigation buttons -->
                        <button
                            @click.stop="prevImage()"
                            :class="{ 'opacity-50 cursor-not-allowed': selectedIndex === 0 }"
                            class="absolute left-2 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors bg-black/50 rounded-full p-2"
                        >
                            <svg class="w-6 h-6 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>

                        <button
                            @click.stop="nextImage()"
                            :class="{ 'opacity-50 cursor-not-allowed': selectedIndex === images.length - 1 }"
                            class="absolute right-2 top-1/2 -translate-y-1/2 text-white hover:text-gray-300 transition-colors bg-black/50 rounded-full p-2"
                        >
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>

                        <!-- Image -->
                        <img
                            :src="selectedImage"
                            @click.stop
                            class="w-full h-full object-contain"
                            :alt="`Gallery image ${selectedIndex + 1}`"
                            loading="lazy"
                        >

                        <!-- Image counter -->
                        <div class="absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full text-sm">
                            <span x-text="selectedIndex + 1"></span> / {{ images | count }}
                        </div>
                    </div>
                </div>
            {{ /if }}
        </div>
    {{ /if }}
{{ /partial:components/block }}
